<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>French Trainer ‚Äì Beginner to Phrases</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f2f2f7;
      padding: 16px;
      max-width: 720px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin: 8px 0 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    .btn-tab, .btn-level {
      flex: 1;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-tab.active, .btn-level.active {
      background: #007aff;
      border-color: #007aff;
      color: #fff;
      font-weight: 600;
    }
    .card {
      padding: 16px;
      margin-top: 8px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    .label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #777;
    }
    .big {
      font-size: 24px;
      font-weight: 600;
      margin: 6px 0;
    }
    .small {
      font-size: 14px;
      color: #555;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button.action {
      width: 100%;
      padding: 11px;
      margin-top: 8px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      cursor: pointer;
    }
    .primary {
      background: #007aff;
      color: #fff;
    }
    .ghost {
      background: #fff;
      color: #007aff;
      border: 1px solid #007aff;
    }
    .secondary-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .secondary-row button {
      flex: 1;
    }
    .feedback {
      margin-top: 8px;
      font-size: 15px;
      min-height: 20px;
    }
    .correct {
      color: #0a9d45;
    }
    .incorrect {
      color: #ff3b30;
    }
    .stats {
      margin-top: 6px;
      font-size: 13px;
      color: #555;
    }
    .mic-status {
      margin-top: 4px;
      font-size: 12px;
      color: #666;
    }
    .hint-note {
      margin-top: 8px;
      font-size: 12px;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>French Trainer</h1>
  <p class="subtitle">Words, numbers & phrases ‚Äì speak or type your answers.</p>

  <!-- Mode: Words vs Phrases -->
  <div class="row">
    <button id="tab-words" class="btn-tab active" type="button">Words</button>
    <button id="tab-phrases" class="btn-tab" type="button">Phrases</button>
  </div>

  <!-- Levels for words -->
  <div id="level-row" class="row">
    <button id="level-b1" class="btn-level active" type="button">Beginner 1</button>
    <button id="level-b2" class="btn-level" type="button">Beginner 2</button>
    <button id="level-b3" class="btn-level" type="button">Beginner 3</button>
    <button id="level-num" class="btn-level" type="button">Numbers & Time</button>
  </div>

  <div class="row">
    <button id="btn-hard" class="btn-level" type="button">Train hard stuff</button>
  </div>

  <div class="card">
    <div class="label" id="prompt-label">Translate this (EN ‚Üí FR):</div>
    <div class="big" id="english-text">Loading‚Ä¶</div>
    <p class="small" id="hint-text"></p>

    <input id="text-answer" placeholder="You can type the French here (optional)">

    <button class="action primary" id="btn-check" type="button">Check (typing)</button>

    <div class="secondary-row">
      <button class="action ghost" id="btn-hear-fr" type="button">üîä Hear French</button>
      <button class="action ghost" id="btn-speak" type="button">üéô Speak answer</button>
    </div>

    <div class="secondary-row">
      <button class="action ghost" id="btn-show" type="button">Show answer</button>
      <button class="action ghost" id="btn-next" type="button">Next ‚ûú</button>
    </div>

    <div class="feedback" id="feedback"></div>
    <div class="stats" id="stats"></div>
    <div class="mic-status" id="mic-status"></div>
  </div>

  <p class="hint-note">
    Daily plan idea (1 hour): 15 min Beginner 1 ‚Üí 15 min Beginner 2 ‚Üí 15 min Beginner 3 ‚Üí 15 min Phrases / Hard stuff.
  </p>

  <script>
    // ---------- DATA ----------
    const wordLevels = {
      // Core survival words
      beginner1: [
        { en: "hello", fr: "bonjour" },
        { en: "goodbye", fr: "au revoir" },
        { en: "please (informal)", fr: "s'il te pla√Æt" },
        { en: "please (formal)", fr: "s'il vous pla√Æt" },
        { en: "thank you", fr: "merci" },
        { en: "yes", fr: "oui" },
        { en: "no", fr: "non" },
        { en: "excuse me", fr: "excusez-moi" },
        { en: "sorry", fr: "d√©sol√©" },
        { en: "okay / all right", fr: "d'accord" },
        { en: "good", fr: "bon" },
        { en: "bad", fr: "mauvais" },
        { en: "today", fr: "aujourd'hui" },
        { en: "tomorrow", fr: "demain" },
        { en: "yesterday", fr: "hier" }
      ],

      // People, places, everyday things
      beginner2: [
        { en: "man", fr: "un homme" },
        { en: "woman", fr: "une femme" },
        { en: "child", fr: "un enfant" },
        { en: "friend (m.)", fr: "un ami" },
        { en: "friend (f.)", fr: "une amie" },
        { en: "family", fr: "la famille" },
        { en: "house / home", fr: "la maison" },
        { en: "room", fr: "la chambre" },
        { en: "street", fr: "la rue" },
        { en: "city", fr: "la ville" },
        { en: "school", fr: "l'√©cole" },
        { en: "work / job", fr: "le travail" },
        { en: "shop / store", fr: "le magasin" },
        { en: "restaurant", fr: "le restaurant" },
        { en: "car", fr: "la voiture" },
        { en: "bus", fr: "le bus" },
        { en: "train", fr: "le train" },
        { en: "airport", fr: "l'a√©roport" }
      ],

      // Food + feelings + key verbs
      beginner3: [
        { en: "water", fr: "l'eau" },
        { en: "bread", fr: "le pain" },
        { en: "coffee", fr: "le caf√©" },
        { en: "tea", fr: "le th√©" },
        { en: "milk", fr: "le lait" },
        { en: "rice", fr: "le riz" },
        { en: "chicken", fr: "le poulet" },
        { en: "fruit", fr: "le fruit" },
        { en: "vegetables", fr: "les l√©gumes" },

        { en: "I am", fr: "je suis" },
        { en: "you are (informal)", fr: "tu es" },
        { en: "we are", fr: "nous sommes" },
        { en: "I have", fr: "j'ai" },
        { en: "you have (informal)", fr: "tu as" },
        { en: "I want", fr: "je veux" },
        { en: "I would like", fr: "je voudrais" },
        { en: "I speak", fr: "je parle" },
        { en: "I don't know", fr: "je ne sais pas" },
        { en: "I understand", fr: "je comprends" },
        { en: "I am tired", fr: "je suis fatigu√©" },
        { en: "I am hungry", fr: "j'ai faim" },
        { en: "I am thirsty", fr: "j'ai soif" }
      ],

      // Numbers and time basics
      numbers: [
        { en: "zero", fr: "z√©ro" },
        { en: "one", fr: "un" },
        { en: "two", fr: "deux" },
        { en: "three", fr: "trois" },
        { en: "four", fr: "quatre" },
        { en: "five", fr: "cinq" },
        { en: "six", fr: "six" },
        { en: "seven", fr: "sept" },
        { en: "eight", fr: "huit" },
        { en: "nine", fr: "neuf" },
        { en: "ten", fr: "dix" },
        { en: "eleven", fr: "onze" },
        { en: "twelve", fr: "douze" },
        { en: "thirteen", fr: "treize" },
        { en: "fourteen", fr: "quatorze" },
        { en: "fifteen", fr: "quinze" },
        { en: "twenty", fr: "vingt" },
        { en: "thirty", fr: "trente" },
        { en: "forty", fr: "quarante" },
        { en: "fifty", fr: "cinquante" },

        { en: "morning", fr: "le matin" },
        { en: "afternoon", fr: "l'apr√®s-midi" },
        { en: "evening", fr: "le soir" },
        { en: "night", fr: "la nuit" },
        { en: "today", fr: "aujourd'hui" },
        { en: "tomorrow", fr: "demain" },
        { en: "yesterday", fr: "hier" },
        { en: "now", fr: "maintenant" },
        { en: "later", fr: "plus tard" },
        { en: "always", fr: "toujours" },
        { en: "never", fr: "jamais" }
      ]
    };

    // Phrases ‚Äì daily life + travel + learning
    const phraseList = [
      { en: "Where is the bathroom?", fr: "O√π sont les toilettes ?" },
      { en: "I don't understand.", fr: "Je ne comprends pas." },
      { en: "Do you speak English?", fr: "Parlez-vous anglais ?" },
      { en: "I speak a little French.", fr: "Je parle un peu fran√ßais." },
      { en: "I am learning French.", fr: "J'apprends le fran√ßais." },
      { en: "Could you repeat, please?", fr: "Pouvez-vous r√©p√©ter, s'il vous pla√Æt ?" },
      { en: "I would like some water, please.", fr: "Je voudrais de l'eau, s'il vous pla√Æt." },
      { en: "How much is this?", fr: "C'est combien ?" },
      { en: "Can you help me?", fr: "Pouvez-vous m'aider ?" },
      { en: "I am lost.", fr: "Je suis perdu." },
      { en: "I feel sick.", fr: "Je me sens mal." },
      { en: "Call an ambulance!", fr: "Appelez une ambulance !" },
      { en: "Where is the train station?", fr: "O√π est la gare ?" },
      { en: "Where is the bus stop?", fr: "O√π est l'arr√™t de bus ?" },
      { en: "I am looking for this address.", fr: "Je cherche cette adresse." },
      { en: "Nice to meet you.", fr: "Enchant√©." },
      { en: "Good morning.", fr: "Bonjour." },
      { en: "Good evening.", fr: "Bonsoir." },
      { en: "Good night.", fr: "Bonne nuit." },
      { en: "See you later.", fr: "√Ä plus tard." },
      { en: "What time is it?", fr: "Il est quelle heure ?" },
      { en: "I'm just looking, thank you.", fr: "Je regarde seulement, merci." },
      { en: "The bill, please.", fr: "L'addition, s'il vous pla√Æt." },
      { en: "Can I pay by card?", fr: "Je peux payer par carte ?" },
      { en: "I am from the United States.", fr: "Je viens des √âtats-Unis." },
      { en: "I like this city.", fr: "J'aime cette ville." }
    ];

    // ---------- STATE ----------
    let mode = "words"; // "words" or "phrases"
    let currentLevel = "beginner1";
    let pool = [];
    let index = 0;
    let correctCount = 0;
    let totalCount = 0;

    // Per-item stats (session only): key -> {correct, total}
    const itemStats = {};

    // ---------- HELPERS ----------
    function shuffle(array) {
      const a = array.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function simplify(str) {
      return str.toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/‚Äô/g, "'")
        .trim();
    }

    function itemKey(item) {
      return `${mode}:${item.fr}`;
    }

    function currentItem() {
      return pool[index];
    }

    function updateItemStats(item, isCorrect) {
      const key = itemKey(item);
      if (!itemStats[key]) {
        itemStats[key] = { correct: 0, total: 0 };
      }
      itemStats[key].total++;
      if (isCorrect) itemStats[key].correct++;
    }

    function getAccuracy(item) {
      const s = itemStats[itemKey(item)];
      if (!s || s.total === 0) return 0; // treat unseen as "needs work"
      return s.correct / s.total;
    }

    // ---------- UI ELEMENTS ----------
    const tabWords = document.getElementById("tab-words");
    const tabPhrases = document.getElementById("tab-phrases");
    const levelRow = document.getElementById("level-row");
    const levelB1 = document.getElementById("level-b1");
    const levelB2 = document.getElementById("level-b2");
    const levelB3 = document.getElementById("level-b3");
    const levelNum = document.getElementById("level-num");

    const btnHard = document.getElementById("btn-hard");

    const englishText = document.getElementById("english-text");
    const hintText = document.getElementById("hint-text");
    const textAnswer = document.getElementById("text-answer");
    const feedbackEl = document.getElementById("feedback");
    const statsEl = document.getElementById("stats");
    const micStatusEl = document.getElementById("mic-status");
    const promptLabel = document.getElementById("prompt-label");

    const btnCheck = document.getElementById("btn-check");
    const btnHear = document.getElementById("btn-hear-fr");
    const btnSpeak = document.getElementById("btn-speak");
    const btnShow = document.getElementById("btn-show");
    const btnNext = document.getElementById("btn-next");

    // ---------- LOAD / UPDATE ----------
    function loadPool() {
      if (mode === "words") {
        pool = shuffle(wordLevels[currentLevel]);
        promptLabel.textContent = "Translate this word (EN ‚Üí FR):";
      } else {
        pool = shuffle(phraseList);
        promptLabel.textContent = "Say this phrase in French (EN ‚Üí FR):";
      }
      index = 0;
      correctCount = 0;
      totalCount = 0;
      loadItem();
    }

    function loadItem() {
      const item = currentItem();
      englishText.textContent = item.en;
      hintText.textContent = mode === "words"
        ? "Speak the French word. Listen first with üîä, then repeat."
        : "Speak the full French phrase. Copy the rhythm and sounds.";
      textAnswer.value = "";
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      updateStats();
    }

    function updateStats() {
      if (totalCount === 0) {
        statsEl.textContent = "No answers yet. Repeat each item out loud a few times.";
      } else {
        const pct = ((correctCount / totalCount) * 100).toFixed(0);
        statsEl.textContent = `Correct this session: ${correctCount}/${totalCount} (${pct}%)`;
      }
    }

    // ---------- SPEECH SYNTHESIS ----------
    function speakFrench() {
      const item = currentItem();
      if (!("speechSynthesis" in window)) {
        alert("Text-to-speech not supported in this browser.");
        return;
      }
      const u = new SpeechSynthesisUtterance(item.fr);
      u.lang = "fr-FR";
      speechSynthesis.speak(u);
    }

    // ---------- TYPED CHECK ----------
    function checkTyped() {
      const item = currentItem();
      const user = simplify(textAnswer.value);
      const correct = simplify(item.fr);

      if (!user) {
        feedbackEl.textContent = "Type something first üôÇ (or use üéô if your browser supports it)";
        feedbackEl.className = "feedback";
        return;
      }

      totalCount++;
      const isCorrect = user === correct;
      updateItemStats(item, isCorrect);

      if (isCorrect) {
        correctCount++;
        feedbackEl.textContent = `‚úÖ Correct! ‚Äú${item.fr}‚Äù`;
        feedbackEl.className = "feedback correct";
      } else {
        feedbackEl.textContent = `‚ùå Correct answer: ‚Äú${item.fr}‚Äù`;
        feedbackEl.className = "feedback incorrect";
      }
      updateStats();
    }

    // ---------- NEXT ----------
    function nextItem() {
      index++;
      if (index >= pool.length) {
        pool = shuffle(pool);
        index = 0;
      }
      loadItem();
    }

    // ---------- HARD STUFF TRAINER ----------
    function trainHardStuff() {
      const source = mode === "words"
        ? Object.values(wordLevels).flat()
        : phraseList.slice();

      // Words with accuracy < 70% OR never answered
      const hard = source.filter(item => getAccuracy(item) < 0.7);

      if (hard.length === 0) {
        feedbackEl.textContent = "üî• Nothing especially hard yet. Keep practicing and this will fill up.";
        feedbackEl.className = "feedback";
        return;
      }

      pool = shuffle(hard);
      index = 0;
      correctCount = 0;
      totalCount = 0;
      loadItem();
      feedbackEl.textContent = "Training hard stuff only. These are the ones your brain needs most.";
      feedbackEl.className = "feedback";
    }

    // ---------- SPEECH RECOGNITION ----------
    let recognition = null;
    let recognizing = false;

    function initSpeechRecognition() {
      if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SR();
        recognition.lang = "fr-FR";
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => {
          recognizing = true;
          micStatusEl.textContent = "üéô Listening‚Ä¶ say the French now.";
        };
        recognition.onend = () => {
          recognizing = false;
          micStatusEl.textContent = "Mic idle. Tap ‚Äúüéô Speak answer‚Äù to try again.";
        };
        recognition.onerror = () => {
          micStatusEl.textContent = "Could not recognize speech. Try again, speak clearly.";
        };
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          handleSpokenAnswer(transcript);
        };

        micStatusEl.textContent = "Mic ready (best in Chrome/Edge).";
      } else {
        micStatusEl.textContent =
          "Speech recognition not supported here (iPhone Safari usually). Use üîä and repeat out loud, or type.";
        btnSpeak.disabled = true;
      }
    }

    function handleSpokenAnswer(transcript) {
      const item = currentItem();
      const user = simplify(transcript);
      const correct = simplify(item.fr);

      totalCount++;
      const isCorrect = user === correct;
      updateItemStats(item, isCorrect);

      if (isCorrect) {
        correctCount++;
        feedbackEl.innerHTML =
          `üéß You said: ‚Äú${transcript}‚Äù<br>‚úÖ That matches: ‚Äú${item.fr}‚Äù`;
        feedbackEl.className = "feedback correct";
      } else {
        feedbackEl.innerHTML =
          `üéß You said: ‚Äú${transcript}‚Äù<br>‚ùå Correct French: ‚Äú${item.fr}‚Äù`;
        feedbackEl.className = "feedback incorrect";
      }
      updateStats();
    }

    function startSpeaking() {
      if (!recognition) {
        alert("Speech recognition not available in this browser. Try Chrome/Edge on a computer, or use typing.");
        return;
      }
      if (!recognizing) recognition.start();
    }

    // ---------- EVENT LISTENERS ----------
    tabWords.addEventListener("click", () => {
      mode = "words";
      tabWords.classList.add("active");
      tabPhrases.classList.remove("active");
      levelRow.style.display = "flex";
      loadPool();
    });

    tabPhrases.addEventListener("click", () => {
      mode = "phrases";
      tabPhrases.classList.add("active");
      tabWords.classList.remove("active");
      levelRow.style.display = "none";
      loadPool();
    });

    levelB1.addEventListener("click", () => {
      currentLevel = "beginner1";
      levelB1.classList.add("active");
      levelB2.classList.remove("active");
      levelB3.classList.remove("active");
      levelNum.classList.remove("active");
      loadPool();
    });

    levelB2.addEventListener("click", () => {
      currentLevel = "beginner2";
      levelB2.classList.add("active");
      levelB1.classList.remove("active");
      levelB3.classList.remove("active");
      levelNum.classList.remove("active");
      loadPool();
    });

    levelB3.addEventListener("click", () => {
      currentLevel = "beginner3";
      levelB3.classList.add("active");
      levelB1.classList.remove("active");
      levelB2.classList.remove("active");
      levelNum.classList.remove("active");
      loadPool();
    });

    levelNum.addEventListener("click", () => {
      currentLevel = "numbers";
      levelNum.classList.add("active");
      levelB1.classList.remove("active");
      levelB2.classList.remove("active");
      levelB3.classList.remove("active");
      loadPool();
    });

    btnHard.addEventListener("click", trainHardStuff);

    btnHear.addEventListener("click", speakFrench);
    btnCheck.addEventListener("click", checkTyped);
    btnNext.addEventListener("click", nextItem);
    btnShow.addEventListener("click", () => {
      feedbackEl.textContent = `Answer: ‚Äú${currentItem().fr}‚Äù`;
      feedbackEl.className = "feedback";
    });
    btnSpeak.addEventListener("click", startSpeaking);

    textAnswer.addEventListener("keyup", (e) => {
      if (e.key === "Enter") {
        checkTyped();
      }
    });

    // ---------- INIT ----------
    loadPool();
    initSpeechRecognition();
  </script>
</body>
</html>
